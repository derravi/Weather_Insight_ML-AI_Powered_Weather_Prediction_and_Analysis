#Import The Requered Library

import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
from sklearn.preprocessing import LabelEncoder,StandardScaler
from sklearn.model_selection import train_test_split
from sklearn.ensemble import RandomForestRegressor
from sklearn.metrics import mean_absolute_error,mean_squared_error,r2_score
from sklearn.linear_model import LinearRegression

print("Lets Import the Datasets.......\n")

df = pd.read_csv("weatherHistory.csv")
df.head()print("Convert the Columns of the Date into the multiple columns........")

df["Formatted Date"] = pd.to_datetime(df['Formatted Date'], utc=True)

df['year'] = df['Formatted Date'].dt.year
df['month'] = df['Formatted Date'].dt.month
df['day'] = df['Formatted Date'].dt.day
df['hour'] = df['Formatted Date'].dt.hour
df['minute'] = df['Formatted Date'].dt.minute
df['second'] = df['Formatted Date'].dt.seconddf.drop(columns='Formatted Date',axis=1,inplace=True)
df.head(3)new_index = [
    "year",
    "month",
    "day",
    "hour",
    "minute",
    "second",
    "Summary",
    "Precip Type",
    "Humidity",
    "Wind Speed (km/h)",
    "Wind Bearing (degrees)",
    "Visibility (km)",
    "Loud Cover",
    "Pressure (millibars)",
    "Apparent Temperature (C)",
    "Daily Summary",
    "Temperature (C)"
]
df = df.reindex(columns=new_index)print(f"The total number of Rows is {df.shape[0]} and the Total Column is {df.shape[1]}")df.head(3)print("Let See there is any null value is present or not........")

df.isnull().sum()print("Lets Fillup the Null value of the Requered Columns........\n")

df['Precip Type'] = df['Precip Type'].fillna(df['Precip Type'].mode()[0])print("Lets ReCheck the null value is present or not........")
df.isnull().sum()temp1 = []
temp2 = []

for i in df.columns:
    if df[i].dtype == 'object':
        #Store Object type of the Columns
        temp1.append(i)
    else:
        #Store Numaric Columns
        temp2.append(i)
        
print("Lets Check the Outliers of the All Columns........\n")

plt.figure(figsize=(15,3*len(temp2)))
for i in range(1,len(temp2)+1):
    plt.subplot(len(temp2),1,i)
    sns.boxplot(x = temp2[i-1],data=df)
    plt.title(f"{i}")
plt.tight_layout()
plt.show()
#Lets Remove the Outliers of the Some Columns That have a very high Outliers.
temp_list = ['Wind Speed (km/h)','Pressure (millibars)','Apparent Temperature (C)']

for i in temp_list:
    q1 = df[i].quantile(0.25)
    q3 = df[i].quantile(0.75)
    iqr = q3 - q1

    min_range = q1 - (1.5 * iqr)
    max_range = q3 + (1.5 * iqr)

    df = df[(df[i] >= min_range) & (df[i] <= max_range)]df.head(3)print("Lets Check the Data Types of the all columns........")
df.dtypes
print("Lets Encode all the Objects type of the Columns........")

# Create a dictionary to store label encoders for each categorical column
label_encoders = {}

for i in temp1:
    lb = LabelEncoder()
    df[i] = lb.fit_transform(df[i])
    label_encoders[i] = lb  # Store the fitted encoder for each column
print("Lets Check the All the Columns after the using Labelencoder........")
df.head()#Feture Selectino
print("Lets Select the Feture for the training data........")
x = df.iloc[:,:-2]
y = df[['Temperature (C)','Daily Summary']]#Train and Test the Model 

x_train,x_test,y_train,y_test = train_test_split(x,y,test_size=0.2,random_state=42)print("Feture Scaling for all the Data........")

std = StandardScaler()

x_train_scaled = std.fit_transform(x_train)
x_test_scaled = std.transform(x_test)#Using the RandomForestRegressor
print("Training Random Forest Regressor Model..........")

lfr = RandomForestRegressor(n_estimators=200,random_state=42,n_jobs=-1)
lfr.fit(x_train_scaled,y_train)

y_predicted = lfr.predict(x_test_scaled)y_temp_predict = y_predicted[:,0]
y_sumury_predict = y_predicted[:,1]print("Lets See the Different Different Parameters of the model........\n")

print("Mean Absolute Error (MAE): ", round(mean_absolute_error(y_test.iloc[:,0], y_temp_predict),2))
print("Mean Squared Error (MSE): ", round(mean_squared_error(y_test.iloc[:,0], y_temp_predict),2))
print("Root Mean Squared Error (RMSE): ", round(np.sqrt(mean_squared_error(y_test.iloc[:,0], y_temp_predict)),2))
print("RÂ² Score: ",round(r2_score(y_test.iloc[:,0], y_temp_predict),2))
#Using the Linear Regression Model

print("Training Linear Regression Model..........")

lr = LinearRegression()

lr.fit(x_train_scaled,y_train)
y_linear_predicted = lr.predict(x_test_scaled)y_temp_linear_predict = y_linear_predicted[:,0]
y_summury_linear_predict = y_linear_predicted[:,1]print("Mean Absolute Error (MAE) : ",round(mean_absolute_error(y_test.iloc[:,0],y_temp_linear_predict),2))
print("Mean Squared Error (MSE) : ",round(mean_squared_error(y_test.iloc[:,0],y_temp_linear_predict),2))
print("Root Mean Square Error (RMSE) : ",round(np.sqrt(mean_squared_error(y_test.iloc[:,0],y_temp_linear_predict)),2))
print("RÂ² Score : ",round(r2_score(y_test.iloc[:,0],y_temp_linear_predict),2))print("======================= User Input Temperature Prediction =======================")

#Define One FUnction for the User Input.
def UserInput():

    #Int User Data
    year = int(input("Enter Year: "))
    month = int(input("Enter Month (e.g., 5, 12, 9): "))
    day = int(input("Enter Day (e.g., 12, 25): "))
    hour = int(input("Enter Hour: "))
    minute = int(input("Enter Minute: "))
    second = int(input("Enter Second: "))

    #Object Types of User data
    Summary = input("Enter Summary (eg.Partly Cloudy,Mostly Cloudy,Overcast,Foggy): ")
    Precip_Type = input("Enter Precip Type (eg.rain,snow): ")       

    #Float User Data
    Humidity = float(input("Enter Humidity: "))         
    Wind_Speed = float(input("Enter Wind Speed (km/h): "))    
    Wind_Bearing = float(input("Enter Wind Bearing (degrees): "))  
    Visibility = float(input("Enter Visibility (km): "))         
    Cloud_Cover = float(input("Enter Cloud Cover: "))          
    Pressure = float(input("Enter Pressure (millibars): "))      
    Apparent_Temperature = float(input("Enter Apparent Temperature (C): "))
    
    data = {
        'year': year,
        'month': month,
        'day': day,
        'hour': hour,
        'minute': minute,
        'second': second,
        'Summary': Summary,
        'Precip Type': Precip_Type",                 
        'Humidity': Humidity,
        'Wind Speed (km/h)': Wind_Speed,
        'Wind Bearing (degrees)': Wind_Bearing,
        'Visibility (km)': Visibility,
        'Loud Cover': Cloud_Cover,                   
        'Pressure (millibars)': Pressure,
        'Apparent Temperature (C)': Apparent_Temperature,
    }
   
    #Make the data frame of this user details. 
    input_data = pd.DataFrame([data])

    #Encode the Categorical Columns using the stored Label Encoders
    categorical_columns = ['Summary', 'Precip Type'] 
    for i in categorical_columns:
        if i in input_data.columns and i in label_encoders:
            input_data[i] = label_encoders[i].transform(input_data[i])

    # Ensure the input data has the same columns as the training data
    input_data = input_data[std.feature_names_in_]
    
    #Rescal the User Input
    scaled_input = std.transform(input_data)

    #Lets Do the Prediction using the Both the Models.

    predict_random_forest = lfr.predict(scaled_input)[0]
    predict_linear_regression = lr.predict(scaled_input)[0]

    # Reverse transform the Daily Summary predictions
    random_forest_reverse_prediction = label_encoders['Daily Summary'].inverse_transform([int(predict_random_forest[1])])[0]
    Linear_regression_reverse_prediction = label_encoders['Daily Summary'].inverse_transform([int(predict_linear_regression[1])])[0]

    print("\n" + "="*70)
    print("ğŸŒ¦ï¸  WEATHER PREDICTION RESULT".center(70))
    print("="*70)

    print("\n[ Random Forest Model ]")
    print(f" â†’ Predicted Temperature : {predict_random_forest[0]:.2f} Â°C")
    print(f" â†’ Predicted Summary     : {random_forest_reverse_prediction}")

    print("\n[ Linear Regression Model ]")
    print(f" â†’ Predicted Temperature : {predict_linear_regression[0]:.2f} Â°C")
    print(f" â†’ Predicted Summary     : {Linear_regression_reverse_prediction}")

    print("\n" + "="*70)
    print("âœ… Prediction Completed Successfully!".center(70))
    print("="*70)



UserInput()

#Temperature vs Apparent Temperature

plt.figure(figsize=(8,5))
sns.scatterplot(x='Temperature (C)',y ='Apparent Temperature (C)',data = df,alpha=0.5,label="Temperature Â°C Data",color='green',edgecolor='black')
plt.title("Temperature vs Appearent Temperature (Â°C)")
plt.xlabel("Temperature (Â°C)")
plt.ylabel("Apparent Temperature (Â°C)")
plt.grid(True,alpha=0.3,color='skyblue')
plt.legend(loc='upper left')
plt.tight_layout()
plt.savefig("Temperature_vs_Appearent_Temperature_Â°C.png",dpi=400,bbox_inches='tight')
plt.show()

#Distribution of Humidity

plt.figure(figsize=(8,4))
plt.hist(df['Humidity'],bins=25,color="red",edgecolor='black')
plt.title("Distribution of Humidity")
plt.xlabel('Humidity')
plt.ylabel('Frequency')
plt.grid(True,color='silver')
plt.savefig("Distribution_of_Humidity.png",dpi=400,bbox_inches='tight')
plt.tight_layout()
plt.show()

#Temperature vs. Humidity

plt.figure(figsize=(12,5))
plt.scatter(df['Humidity'],df['Temperature (C)'],color="yellow",edgecolor='black')
plt.title("Temperature vs Humidity")
plt.xlabel('Humidity')
plt.ylabel('Temperature (Â°C)')
plt.grid(True,color='silver')
plt.savefig("Temperature_vs_Humidity.png",dpi=400,bbox_inches='tight')
plt.tight_layout()
plt.show()

plt.figure(figsize=(12,8))
corr = df.corr()
plt.imshow(corr, cmap='coolwarm', interpolation='nearest')
plt.colorbar()
plt.xticks(range(len(corr)), corr.columns, rotation=90)
plt.yticks(range(len(corr)), corr.columns)
plt.title("Correlation Matrix", fontsize=16)
plt.savefig("Correlation_Matrix.png",dpi=400,bbox_inches='tight')
plt.tight_layout()
plt.show()

